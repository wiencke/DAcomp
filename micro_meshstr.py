#!/usr/bin/env python

from fipy.meshes import Gmsh3D 

cfgfile = 'parameters'
from parameters import *

def microMesh(cl1, cl2, dist, rad1, rad2):	
# cl1 and cl2 define meshsize, dist = distance pre-post, rad1 = radius synaptic cleft, rad2 = radius simulation space
  MESHstr = """
  cl1 = %(cl1)g;
  cl2 = %(cl2)g;
  dist = %(dist)g;
  rad1 = %(rad1)g;
  rad2 = %(rad2)g;
  Point(1) = {0, 0, 0, cl1};
  Point(2) = {rad1, 0, dist/2, cl1};
  Point(3) = {0, rad1, dist/2, cl1};
  Point(4) = {0, 0, rad1, cl2};
  Point(5) = {-rad1, 0, dist/2, cl1};
  Point(6) = {0, -rad1, dist/2, cl1};
  Point(8) = {0, 0, 0, cl2};
  Point(9) = {rad2, 0, 0, cl2};
  Point(10) = {0, rad2, 0, cl2};
  Point(11) = {0, 0, rad2, cl2};
  Point(12) = {-rad2, 0, 0, cl2};
  Point(13) = {0, -rad2, 0, cl2};
  Point(14) = {0, 0, -rad2, cl2};
  Point(15) = {rad1, 0, -dist/2, cl1};
  Point(16) = {0, rad1, -dist/2, cl1};
  Point(17) = {0, 0, -rad1, cl2};
  Point(18) = {-rad1, 0, -dist/2, cl1};
  Point(19) = {0, -rad1, -dist/2, cl1};
  Point(20) = {0, 0, dist/2, cl1};
  Point(21) = {0, 0, -dist/2, cl1};
  Circle(3) = {5, 1, 4};
  Circle(4) = {4, 1, 2};
  Circle(5) = {2, 20, 3};
  Circle(6) = {3, 20, 5};
  Circle(7) = {5, 20, 6};
  Circle(8) = {6, 20, 2};
  Circle(10) = {3, 1, 4};
  Circle(11) = {4, 1, 6};
  Circle(31) = {9, 8, 14};
  Circle(32) = {14, 8, 12};
  Circle(33) = {12, 8, 11};
  Circle(34) = {11, 8, 9};
  Circle(35) = {9, 8, 10};
  Circle(36) = {10, 8, 12};
  Circle(37) = {12, 8, 13};
  Circle(38) = {13, 8, 9};
  Circle(39) = {14, 8, 10};
  Circle(40) = {10, 8, 11};
  Circle(41) = {11, 8, 13};
  Circle(42) = {13, 8, 14};
  Circle(66) = {16, 21, 18};
  Circle(67) = {18, 21, 19};
  Circle(68) = {19, 1, 17};
  Circle(69) = {19, 21, 15};
  Circle(70) = {15, 21, 16};
  Circle(73) = {17, 1, 16};
  Circle(74) = {18, 1, 17};
  Circle(75) = {17, 1, 15};
  Line Loop(14) = {5, 10, 4};
  Ruled Surface(14) = {14};
  Line Loop(20) = {8, -4, 11};
  Ruled Surface(20) = {20};
  Line Loop(22) = {-10, 6, 3};
  Ruled Surface(22) = {22};
  Line Loop(24) = {-11, -3, 7};
  Ruled Surface(24) = {24};
  Line Loop(44) = {35, 40, 34};
  Ruled Surface(44) = {44};
  Line Loop(46) = {39, -35, 31};
  Ruled Surface(46) = {46};
  Line Loop(48) = {42, -31, -38};
  Ruled Surface(48) = {48};
  Line Loop(50) = {38, -34, 41};
  Ruled Surface(50) = {50};
  Line Loop(52) = {-40, 36, 33};
  Ruled Surface(52) = {52};
  Line Loop(54) = {-41, -33, 37};
  Ruled Surface(54) = {54};
  Line Loop(56) = {-32, -42, -37};
  Ruled Surface(56) = {56};
  Line Loop(58) = {-36, -39, 32};
  Ruled Surface(58) = {58};
  Line Loop(63) = {5, 6, 7, 8};
  Plane Surface(63) = {63};
  Line Loop(72) = {70, 66, 67, 69};
  Plane Surface(72) = {72};
  Line Loop(77) = {75, -69, 68};
  Ruled Surface(77) = {77};
  Line Loop(79) = {73, -70, -75};
  Ruled Surface(79) = {79};
  Line Loop(81) = {66, 74, 73};
  Ruled Surface(81) = {81};
  Line Loop(83) = {68, -74, 67};
  Ruled Surface(83) = {83};
  Surface Loop(86) = {63, 14, 22, 24, 20, 83, 77, 79, 81, 72, 54, 50, 48, 56, 58, 52, 44, 46};
  Volume(86) = {86};"""
  mesh = Gmsh3D(MESHstr % locals())
  print 'created synaptic terminal mesh...'
  return mesh


def microMesh_nonsynaptic(cl1, cl2, dist, rad1, rad2):	
# cl1 and cl2 define meshsize, dist = distance pre-post, rad1 = radius synaptic cleft, rad2 = radius simulation space
  MESHstr = """
  cl1 = %(cl1)g;
  cl2 = %(cl2)g;
  dist = %(dist)g;
  rad1 = %(rad1)g;
  rad2 = %(rad2)g;
  Point(1) = {0, 0, 0, cl1};
  Point(2) = {rad1, 0, dist/2, cl1};
  Point(3) = {0, rad1, dist/2, cl1};
  Point(4) = {0, 0, rad1, cl2};
  Point(5) = {-rad1, 0, dist/2, cl1};
  Point(6) = {0, -rad1, dist/2, cl1};
  Point(8) = {0, 0, 0, cl2};
  Point(9) = {rad2, 0, 0, cl2};
  Point(10) = {0, rad2, 0, cl2};
  Point(11) = {0, 0, rad2, cl2};
  Point(12) = {-rad2, 0, 0, cl2};
  Point(13) = {0, -rad2, 0, cl2};
  Point(14) = {0, 0, -rad2, cl2};
  Point(20) = {0, 0, dist/2, cl1};
  Circle(3) = {5, 1, 4};
  Circle(4) = {4, 1, 2};
  Circle(5) = {2, 20, 3};
  Circle(6) = {3, 20, 5};
  Circle(7) = {5, 20, 6};
  Circle(8) = {6, 20, 2};
  Circle(10) = {3, 1, 4};
  Circle(11) = {4, 1, 6};
  Circle(31) = {9, 8, 14};
  Circle(32) = {14, 8, 12};
  Circle(33) = {12, 8, 11};
  Circle(34) = {11, 8, 9};
  Circle(35) = {9, 8, 10};
  Circle(36) = {10, 8, 12};
  Circle(37) = {12, 8, 13};
  Circle(38) = {13, 8, 9};
  Circle(39) = {14, 8, 10};
  Circle(40) = {10, 8, 11};
  Circle(41) = {11, 8, 13};
  Circle(42) = {13, 8, 14};
  Line Loop(14) = {5, 10, 4};
  Ruled Surface(14) = {14};
  Line Loop(20) = {8, -4, 11};
  Ruled Surface(20) = {20};
  Line Loop(22) = {-10, 6, 3};
  Ruled Surface(22) = {22};
  Line Loop(24) = {-11, -3, 7};
  Ruled Surface(24) = {24};
  Line Loop(44) = {35, 40, 34};
  Ruled Surface(44) = {44};
  Line Loop(46) = {39, -35, 31};
  Ruled Surface(46) = {46};
  Line Loop(48) = {42, -31, -38};
  Ruled Surface(48) = {48};
  Line Loop(50) = {38, -34, 41};
  Ruled Surface(50) = {50};
  Line Loop(52) = {-40, 36, 33};
  Ruled Surface(52) = {52};
  Line Loop(54) = {-41, -33, 37};
  Ruled Surface(54) = {54};
  Line Loop(56) = {-32, -42, -37};
  Ruled Surface(56) = {56};
  Line Loop(58) = {-36, -39, 32};
  Ruled Surface(58) = {58};
  Line Loop(63) = {5, 6, 7, 8};
  Plane Surface(63) = {63};
  Surface Loop(86) = {63, 14, 22, 24, 20, 54, 50, 48, 56, 58, 52, 44, 46};
  Volume(86) = {86};"""
  mesh = Gmsh3D(MESHstr % locals())
  print 'created non-synaptic terminal mesh...'
  return mesh
